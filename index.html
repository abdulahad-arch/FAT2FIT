<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FAT2FIT — Personalized Plan</title>
<!-- Unsplash background (web stock gym images). Replace if you want your own images -->
<style>
  :root{
    --bg:#080808;
    --panel:#0f0f10;
    --accent:#e02121;
    --accent-2:#ff5555;
    --muted:#bfbfbf;
  }
  *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;}
  html,body{height:100%;margin:0;background:
    linear-gradient(180deg, rgba(0,0,0,0.65), rgba(0,0,0,0.9)),
    url("https://images.unsplash.com/photo-1554284126-aa88f22d8d34?q=80&w=1600&auto=format&fit=crop&ixlib=rb-4.0.3&s=2c3f8f7c9697a7c5e7c2f3b7e9d0c4e4") center/cover no-repeat;
    color:#fff;}
  .wrap{max-width:980px;margin:20px auto;padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.25));box-shadow:0 12px 40px rgba(0,0,0,0.7);}
  header{display:flex;align-items:center;gap:14px}
  img.logo{width:84px;height:84px;object-fit:contain;border-radius:10px;background:#000;border:1px solid rgba(255,255,255,0.04);}
  h1{font-size:28px;margin:0;color:var(--accent);letter-spacing:1px;}
  p.lead{margin:0;color:var(--muted);}

  .grid{display:grid;grid-template-columns:360px 1fr;gap:18px;margin-top:16px;}
  .panel{background:var(--panel);padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);}
  label{display:block;font-size:13px;color:var(--muted);margin-top:8px}
  input[type="text"], input[type="number"], select{width:100%;padding:9px;border-radius:8px;border:none;background:rgba(255,255,255,0.02);color:#fff}
  .row{display:flex;gap:8px}
  .small{flex:1}
  .btn{background:linear-gradient(180deg,var(--accent),#9b0000);border:none;padding:10px 12px;border-radius:10px;color:#fff;font-weight:700;cursor:pointer;margin-top:12px;box-shadow:0 6px 18px rgba(224,34,34,0.14);transition:transform .14s}
  .btn:hover{transform:translateY(-3px)}
  .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  .summary{margin-top:10px}
  .stat{display:flex;justify-content:space-between;padding:10px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.03));margin-bottom:8px}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{padding:8px;border:1px solid rgba(255,255,255,0.04);font-size:14px}
  th{background:rgba(224,34,34,0.12);color:var(--accent-2);text-transform:uppercase;font-size:12px}
  .explain{white-space:pre-wrap;background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;margin-top:8px;color:var(--muted)}
  .suggestions{margin-top:10px}
  .download-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  .muted{color:var(--muted)}
  @media(max-width:920px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap" role="main">
  <header>
    <!-- Replace logo.png with your uploaded file in repo -->
    <img class="logo" src="logo.png" alt="FAT2FIT logo (replace file if needed)">
    <div>
      <h1>FAT2FIT</h1>
      <p class="lead">Personalized body transformation plans — diet, macros & suggestions</p>
    </div>
  </header>

  <div class="grid">
    <!-- LEFT: client input -->
    <aside class="panel" aria-label="Client details">
      <h3 style="margin:0 0 8px 0;color:var(--accent)">Client Details</h3>

      <label for="cname">Full name</label>
      <input id="cname" type="text" placeholder="John Doe">

      <div class="row">
        <div class="small">
          <label for="age">Age</label>
          <input id="age" type="number" min="12" max="100" value="28">
        </div>
        <div style="width:10px"></div>
        <div class="small">
          <label for="sex">Sex</label>
          <select id="sex"><option value="male">Male</option><option value="female">Female</option></select>
        </div>
      </div>

      <div class="row">
        <div class="small">
          <label for="height">Height (cm)</label>
          <input id="height" type="number" min="100" max="250" value="175">
        </div>
        <div style="width:10px"></div>
        <div class="small">
          <label for="weight">Weight (kg)</label>
          <input id="weight" type="number" min="30" max="300" value="80">
        </div>
      </div>

      <label for="activity">Activity level</label>
      <select id="activity">
        <option value="1.2">Sedentary (office)</option>
        <option value="1.375">Lightly active</option>
        <option value="1.55" selected>Moderately active</option>
        <option value="1.725">Very active</option>
      </select>

      <label for="goal">Goal</label>
      <select id="goal">
        <option value="lose">Lose weight / fat</option>
        <option value="maintain">Maintain weight</option>
        <option value="gain">Gain muscle / bulk</option>
      </select>

      <label for="pref">Diet preference</label>
      <select id="pref">
        <option value="nonveg">Non-vegetarian</option>
        <option value="veg">Vegetarian</option>
      </select>

      <div style="display:flex;gap:8px;">
        <button class="btn" id="genBtn">Generate Plan</button>
        <button class="btn secondary" id="saveBtn">Save (local)</button>
      </div>

      <div class="summary">
        <div class="stat"><div><small>BMR</small><div id="bmr">— kcal</div></div><div><small>TDEE</small><div id="tdee">— kcal</div></div></div>
        <div class="stat"><div><small>Daily target</small><div id="daily">— kcal</div></div><div><small>Macros (g P/C/F)</small><div id="macros">—</div></div></div>
      </div>

      <div style="margin-top:8px;">
        <small class="muted">Tip: replace hero background or logo by adding your images to the repo and editing the file paths.</small>
      </div>
    </aside>

    <!-- RIGHT: results -->
    <main class="panel" aria-label="Plan results">
      <h3 style="margin:0 0 8px 0;color:var(--accent)">Plan Summary</h3>

      <div id="explain" class="explain muted">No plan generated yet — enter client details and click "Generate Plan".</div>

      <div id="dietBlock" style="display:none;margin-top:12px;">
        <h4 style="margin:8px 0;color:var(--accent)">Daily Diet Plan</h4>
        <div id="dietTableWrap"></div>

        <div style="display:flex;justify-content:space-between;gap:10px;align-items:center;margin-top:10px;">
          <div class="suggestions">
            <h4 style="margin:0;color:var(--accent)">Suggestions</h4>
            <div id="suggestionsText" class="muted"></div>
          </div>

          <div style="min-width:260px">
            <div style="font-size:13px;color:var(--muted);margin-bottom:6px">Totals</div>
            <table><thead><tr><th>Calories</th><th>Protein (g)</th><th>Carbs (g)</th><th>Fat (g)</th></tr></thead>
              <tbody><tr><td id="totCal">0</td><td id="totP">0</td><td id="totC">0</td><td id="totF">0</td></tr></tbody></table>
          </div>
        </div>

        <div class="download-row">
          <button class="btn" id="csvBtn">Download CSV</button>
          <button class="btn" id="pdfBtn">Download PDF</button>
          <button class="btn secondary" id="printBtn">Print Plan</button>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- jsPDF for PDF export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
/* ===========================
   FAT2FIT: Plan generator JS
   ===========================
   - BMR: Mifflin-St Jeor (step-by-step)
   - TDEE = BMR * activity multiplier
   - Goal adjustment: lose => -18%, gain => +10%, maintain => 0%
   - Macro splits by goal
   - Distribute daily calories across meals
   - Veg / Non-veg meal templates (estimate calories & macros per meal)
   - CSV & PDF exports
   - Save to localStorage
   =========================== */

(function(){
  // Helpers
  const $ = id => document.getElementById(id);
  const round2 = n => Math.round(n*100)/100;
  const toFixed = n => (Math.round(n*100)/100).toLocaleString();

  // Meal slots (sequenced)
  const mealSlots = ["Morning (Breakfast)","Mid-morning","Lunch","Afternoon Snack","Dinner"];

  // Basic food templates: each item is {name, kcal, protein, carbs, fat} per suggested portion.
  // These are approximations — you can refine later or replace with a food DB.
  const templates = {
    nonveg: {
      breakfast: {name:"Oats (50g) + 2 Eggs", kcal:360, protein:26, carbs:42, fat:10},
      mid: {name:"Greek Yogurt + Banana", kcal:180, protein:12, carbs:26, fat:3},
      lunch: {name:"Grilled Chicken (150g) + Rice (150g) + Veg", kcal:650, protein:55, carbs:80, fat:12},
      snack: {name:"Almonds (30g) + Fruit", kcal:220, protein:7, carbs:18, fat:14},
      dinner: {name:"Salmon (150g) + Sweet Potato", kcal:520, protein:45, carbs:45, fat:18}
    },
    veg: {
      breakfast: {name:"Oats (70g) + Milk", kcal:420, protein:18, carbs:64, fat:8},
      mid: {name:"Greek Yogurt (veg) / Soy Yogurt + Fruit", kcal:170, protein:9, carbs:26, fat:4},
      lunch: {name:"Paneer (150g) + Brown Rice (150g) + Veg", kcal:650, protein:38, carbs:80, fat:22},
      snack: {name:"Roasted Chickpeas (50g) + Fruit", kcal:200, protein:12, carbs:26, fat:6},
      dinner: {name:"Lentil Curry + Quinoa", kcal:520, protein:30, carbs:60, fat:14}
    }
  };

  // Macro split presets (% of daily calories)
  function macroPercentForGoal(goal){
    if (goal === 'lose') return {p:35,c:35,f:30};
    if (goal === 'gain') return {p:30,c:45,f:25};
    return {p:30,c:40,f:30}; // maintain
  }

  // Calculate BMR with Mifflin-St Jeor (explicit step-by-step for safety)
  function calcBMR({sex,weight,height,age}){
    // base = 10*weight + 6.25*height - 5*age
    const step1 = 10 * weight;            // 10 * kg
    const step2 = 6.25 * height;          // 6.25 * cm
    const step3 = 5 * age;                // 5 * years
    const base = step1 + step2 - step3;   // sum up
    const bmr = (sex === 'male') ? base + 5 : base - 161;
    // return detailed object
    return {bmr: round2(bmr), steps:{step1,step2,step3,base}};
  }

  function computePlan(){
    // read client fields
    const name = $('cname').value || 'Client';
    const age = Number($('age').value);
    const sex = $('sex').value;
    const height = Number($('height').value);
    const weight = Number($('weight').value);
    const activity = Number($('activity').value);
    const goal = $('goal').value; // lose / maintain / gain
    const pref = $('pref').value; // veg / nonveg

    if (!age || !height || !weight) { alert('Enter valid age / height / weight'); return; }

    // BMR step-by-step (Mifflin-St Jeor)
    const bmrObj = calcBMR({sex,weight,height,age});
    const BMR = bmrObj.bmr; // kcal/day

    // TDEE
    const TDEE = round2(BMR * activity);

    // Goal adjustment
    let dailyTarget = TDEE;
    let note = 'Maintain calories';
    if (goal === 'lose'){ dailyTarget = round2(TDEE * 0.82); note = 'Deficit chosen (~18%) for fat loss'; }
    if (goal === 'gain'){ dailyTarget = round2(TDEE * 1.10); note = 'Surplus chosen (~10%) for muscle gain'; }

    // Macro percents and grams (calories to grams: protein/carbs 4 kcal/g, fat 9 kcal/g)
    const perc = macroPercentForGoal(goal);
    const calProtein = dailyTarget * (perc.p/100);
    const calCarbs = dailyTarget * (perc.c/100);
    const calFat = dailyTarget * (perc.f/100);
    const gramsProtein = round2(calProtein / 4);
    const gramsCarbs = round2(calCarbs / 4);
    const gramsFat = round2(calFat / 9);

    // Water recommendation: typical guideline ~35 ml per kg -> liters
    const waterMl = round2(weight * 35);
    const waterL = round2(waterMl / 1000);

    // distribute daily calories across meals (percent of daily)
    // breakfast 22%, mid 8%, lunch 32%, snack 10%, dinner 28% (example)
    const mealPercents = [0.22, 0.08, 0.32, 0.10, 0.28];

    // choose templates based on veg / nonveg
    const bank = (pref === 'veg') ? templates.veg : templates.nonveg;

    // Build meal list by scaling template kcal/macros to hit meal calorie target.
    const meals = mealSlots.map((slot, idx) => {
      // pick template for slot
      const key = (idx===0 ? 'breakfast' : idx===1 ? 'mid' : idx===2 ? 'lunch' : idx===3 ? 'snack' : 'dinner');
      const tpl = bank[key];
      // desired calories for this meal
      const targetMealCal = round2(dailyTarget * mealPercents[idx]);
      // template calories (approx). We'll scale portion so template kcal matches targetMealCal.
      const scale = targetMealCal / tpl.kcal;
      // compute macros by scaling (step-by-step)
      const kcal = round2(tpl.kcal * scale);
      const protein = round2(tpl.protein * scale);
      const carbs = round2(tpl.carbs * scale);
      const fat = round2(tpl.fat * scale);
      const nameSuggested = tpl.name + (scale !== 1 ? ` (adjust ~${Math.round(scale*100)}%)` : '');
      return {slot, name:nameSuggested, kcal, protein, carbs, fat, targetMealCal};
    });

    // Totals (sum of meals)
    const totals = meals.reduce((acc,m)=>{
      acc.cal += m.kcal; acc.p += m.protein; acc.c += m.carbs; acc.f += m.fat; return acc;
    }, {cal:0,p:0,c:0,f:0});
    totals.cal = round2(totals.cal); totals.p = round2(totals.p); totals.c = round2(totals.c); totals.f = round2(totals.f);

    // 10-line short explanation about body structure + short plan (concise, actionable)
    const explainLines = [];
    explainLines.push(`${name}, quick body & plan summary:`);
    explainLines.push(`1) Basal Metabolic Rate (BMR) ~ ${BMR} kcal/day — energy burned at rest.`);
    explainLines.push(`2) Total Daily Energy Expenditure (TDEE) ~ ${TDEE} kcal/day (activity multiplier ${activity}).`);
    explainLines.push(`3) Goal adjustment: ${note} → daily target ~ ${dailyTarget} kcal.`);
    explainLines.push(`4) Protein aim: ${gramsProtein} g/day to support muscle & satiety.`);
    explainLines.push(`5) Carbs: ${gramsCarbs} g/day for energy; Fats: ${gramsFat} g/day for hormones.`);
    explainLines.push(`6) Focus on progressive resistance training (3-5x/wk) + 1-2 cardio sessions.`);
    explainLines.push(`7) Prioritize whole foods: lean protein, whole grains, legumes, veg & healthy fats.`);
    explainLines.push(`8) Sleep & recovery: 7-9 hrs/night; manage stress to aid progress.`);
    explainLines.push(`9) Track weight & adjust calories weekly by 200-300 kcal if no progress.`);

    // Suggestions text
    const suggestions = [];
    suggestions.push(`Drink ~${waterL} L water/day (approx ${waterMl} ml) based on body weight.`);
    suggestions.push(`Protein target: ${gramsProtein} g/day. Spread across meals (≈${round2(gramsProtein/mealSlots.length)} g/meal).`);
    suggestions.push(`Aim for 3 main meals + 2 snacks as shown; adjust portions to hit daily calories.`);
    suggestions.push(`If ${goal === 'lose' ? 'losing' : goal === 'gain' ? 'gaining' : 'maintaining'}: weigh yourself weekly and adjust.`);
    suggestions.push(`Consider adding a multivitamin if diet lacks variety and consult a nutritionist for special cases.`);

    // Save plan object for exports
    const planObj = {name,age,sex,height,weight,activity,goal,pref,BMR,TDEE,dailyTarget,perc,gramsProtein,gramsCarbs,gramsFat,waterL,waterMl,meals,totals,explainLines,suggestions};

    // Render to UI
    renderPlan(planObj);

    // save last plan to localStorage
    localStorage.setItem('fat2fit_last', JSON.stringify(planObj));

    // return plan for debugging if needed
    return planObj;
  }

  // RENDER function
  function renderPlan(plan){
    // explain (10 lines)
    $('explain').textContent = plan.explainLines.join('\n');

    // build diet table
    const wrap = $('dietTableWrap');
    wrap.innerHTML = '';
    const table = document.createElement('table');
    const thead = document.createElement('thead');
    thead.innerHTML = '<tr><th>Meal time</th><th>Suggested food (portion)</th><th>Calories</th><th>Protein (g)</th><th>Carbs (g)</th><th>Fat (g)</th></tr>';
    table.appendChild(thead);
    const tbody = document.createElement('tbody');
    plan.meals.forEach(m=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${m.slot}</td><td style="text-align:left">${m.name}</td><td>${m.kcal}</td><td>${m.protein}</td><td>${m.carbs}</td><td>${m.fat}</td>`;
      tbody.appendChild(tr);
    });
    table.appendChild(tbody);
    wrap.appendChild(table);

    // totals
    $('totCal').textContent = plan.totals.cal;
    $('totP').textContent = plan.totals.p;
    $('totC').textContent = plan.totals.c;
    $('totF').textContent = plan.totals.f;

    // suggestions
    $('suggestionsText').innerHTML = plan.suggestions.join('<br>');

    // show block
    $('dietBlock').style.display = 'block';
    // store currentPlan for exports
    window.currentFat2FitPlan = plan;
  }

  // Export CSV
  function exportCSV(plan){
    if (!plan || !plan.meals) { alert('Generate a plan first'); return; }
    let csv = 'Meal time,Food (portion),Calories,Protein (g),Carbs (g),Fat (g)\n';
    plan.meals.forEach(m=>{
      // Escape commas in food names by wrapping in quotes
      csv += `"${m.slot}","${m.name}",${m.kcal},${m.protein},${m.carbs},${m.fat}\n`;
    });
    csv += `\nTotals, ,${plan.totals.cal},${plan.totals.p},${plan.totals.c},${plan.totals.f}\n`;
    csv += `\nClient,${plan.name},Age:${plan.age},Sex:${plan.sex},Height:${plan.height}cm,Weight:${plan.weight}kg\n`;
    csv += `Daily Target,${plan.dailyTarget} kcal\n`;
    // download
    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = `${(plan.name||'client')}_fat2fit_diet.csv`; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }

  // Export PDF using jsPDF
  async function exportPDF(plan){
    if (!plan || !plan.meals) { alert('Generate a plan first'); return; }
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({unit:'pt',format:'a4'});
    const left = 40;
    let y = 40;
    doc.setFillColor(0,0,0);
    doc.setFontSize(18);
    doc.setTextColor(224,34,34);
    doc.text('FAT2FIT — Personalized Diet Plan', left, y);
    y += 22;
    doc.setFontSize(11);
    doc.setTextColor(200,200,200);
    doc.text(`Client: ${plan.name}  Age: ${plan.age}  Sex: ${plan.sex}`, left, y); y+=16;
    doc.text(`Height: ${plan.height} cm  Weight: ${plan.weight} kg  Goal: ${plan.goal}`, left, y); y+=20;
    doc.text(`Daily target: ${plan.dailyTarget} kcal  (BMR ${plan.BMR} kcal, TDEE ${plan.TDEE} kcal)`, left, y); y+=20;

    doc.setDrawColor(200);
    doc.setLineWidth(0.5);
    doc.line(left, y, 560, y); y+=12;

    doc.setFontSize(12);
    // table header
    doc.setTextColor(255,255,255);
    doc.text('Meal', left, y); doc.text('Food (portion)', left+100, y); doc.text('Cal', left+360, y); doc.text('P', left+410, y); doc.text('C', left+455, y); doc.text('F', left+500, y);
    y+=10;
    doc.setLineWidth(0.3); doc.line(left, y, 560, y); y+=12;
    // rows
    doc.setFontSize(11);
    plan.meals.forEach(m=>{
      if (y > 750){ doc.addPage(); y = 40; } // new page if needed
      doc.text(m.slot, left, y);
      // wrap food name if long
      doc.text(m.name, left+100, y, {maxWidth:240});
      doc.text(String(m.kcal), left+360, y);
      doc.text(String(m.protein), left+410, y);
      doc.text(String(m.carbs), left+455, y);
      doc.text(String(m.fat), left+500, y);
      y+=18;
    });

    y += 8;
    doc.text('Totals:', left, y);
    doc.text(String(plan.totals.cal), left+360, y);
    doc.text(String(plan.totals.p), left+410, y);
    doc.text(String(plan.totals.c), left+455, y);
    doc.text(String(plan.totals.f), left+500, y);
    y+=22;

    doc.setFontSize(11);
    doc.text('Suggestions:', left, y); y+=14;
    plan.suggestions.forEach(s=>{
      if (y > 760){ doc.addPage(); y = 40; }
      // simple wrap
      const lines = doc.splitTextToSize(s, 480);
      doc.text(lines, left, y);
      y += (lines.length * 12) + 6;
    });

    doc.save(`${(plan.name||'client')}_fat2fit_plan.pdf`);
  }

  // Load saved last plan if exists
  function loadLast(){
    const raw = localStorage.getItem('fat2fit_last');
    if (!raw) return;
    try{
      const plan = JSON.parse(raw);
      window.currentFat2FitPlan = plan;
      renderPlan(plan);
    }catch(e){}
  }

  // Print plan (simple)
  function printPlan(){
    if (!window.currentFat2FitPlan){ alert('Generate a plan first'); return; }
    const p = window.currentFat2FitPlan;
    // open new window and render simple printable HTML
    const w = window.open('','_blank','width=900,height=700');
    let html = `<html><head><title>FAT2FIT Plan</title><style>body{font-family:Arial;color:#111;background:#fff;padding:20px}h2{color:#b30000}</style></head><body>`;
    html += `<h2>FAT2FIT — Diet Plan for ${p.name}</h2>`;
    html += `<p>Daily target: ${p.dailyTarget} kcal (BMR ${p.BMR} kcal, TDEE ${p.TDEE} kcal)</p>`;
    html += `<table border="1" cellpadding="8" cellspacing="0"><tr><th>Meal</th><th>Food (portion)</th><th>Cal</th><th>P (g)</th><th>C (g)</th><th>F (g)</th></tr>`;
    p.meals.forEach(m => {
      html += `<tr><td>${m.slot}</td><td>${m.name}</td><td>${m.kcal}</td><td>${m.protein}</td><td>${m.carbs}</td><td>${m.fat}</td></tr>`;
    });
    html += `</table>`;
    html += `<h3>Suggestions</h3><ul>`;
    p.suggestions.forEach(s=> html += `<li>${s}</li>`);
    html += `</ul></body></html>`;
    w.document.write(html); w.document.close();
    w.focus();
    // optionally call print automatically:
    // w.print();
  }

  // Wire up buttons
  $('genBtn').addEventListener('click', ()=> computePlan());
  $('csvBtn').addEventListener('click', ()=> exportCSV(window.currentFat2FitPlan));
  $('pdfBtn').addEventListener('click', ()=> exportPDF(window.currentFat2FitPlan));
  $('printBtn').addEventListener('click', ()=> printPlan());
  $('saveBtn').addEventListener('click', ()=> {
    if (!window.currentFat2FitPlan) { alert('Generate first'); return; }
    const arr = JSON.parse(localStorage.getItem('fat2fit_archive')||'[]');
    arr.push(window.currentFat2FitPlan);
    localStorage.setItem('fat2fit_archive', JSON.stringify(arr));
    alert('Plan saved in browser (local).');
  });

  // Initialize: load last
  loadLast();

})();
</script>
</body>
</html>
